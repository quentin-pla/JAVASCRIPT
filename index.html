<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Sokoban</title>
    <script src="jquery-3.3.1.min.js"></script>
    <script>
        $(document).ready(function (argument) {
            let monObj = {"copyright":"ASCII Corporation","description":"60 levels original MSX version of Sokoban - 1984","levels":[{"cells":["    #####","    #   #","    #$  #","  ###  $###","  #  $  $ #","### # ### #     ######","#   # ### #######  ..#","# $  $             ..#","##### #### #@####  ..#","    #      ###  ######","    ########"]},{"cells":["############","#..  #     ###","#..  # $  $  #","#..  #$####  #","#..    @ ##  #","#..  # #  $ ##","###### ##$ $ #","  # $  $ $ $ #","  #    #     #","  ############"]},{"cells":["        ########","        #     @#","        # $#$ ##","        # $  $#","        ##$ $ #","######### $ # ###","#....  ## $  $  #","##...    $  $   #","#....  ##########","########"]},{"cells":["              ########","              #  ....#","   ############  ....#","   #    #  $ $   ....#","   # $$$#$  $ #  ....#","   #  $     $ #  ....#","   # $$ #$ $ $########","####  $ #     #","#   # #########","#    $  ##","# $$#$$ @#","#   #   ##","#########"]},{"cells":["        #####","        #   #####","        # #$##  #","        #     $ #","######### ###   #","#....  ## $  $###","#....    $ $$ ##","#....  ##$  $ @#","#########  $  ##","        # $ $  #","        ### ## #","          #    #","          ######"]},{"cells":["######  ###","#..  # ##@##","#..  ###   #","#..     $$ #","#..  # # $ #","#..### # $ #","#### $ #$  #","   #  $# $ #","   # $  $  #","   #  ##   #","   #########"]},{"cells":["       #####"," #######   ##","## # @## $$ #","#    $      #","#  $  ###   #","### #####$###","# $  ### ..#","# $ $ $ ...#","#    ###...#","# $$ # #...#","#  ### #####","####"]},{"cells":["  ####","  #  ###########","  #    $   $ $ #","  # $# $ #  $  #","  #  $ $  #    #","### $# #  #### #","#@#$ $ $  ##   #","#    $ #$#   # #","##  $    $ $ $ #"," ####  #########","  ###  ###","  #      #","  #      #","  #......#","  #......#","  #......#","  ########"]},{"cells":["          #######","          #  ...#","      #####  ...#","      #      ...#","      #  ##  ...#","      ## ##  ...#","     ### ########","     # $$$ ##"," #####  $ $ #####","##   #$ $   #   #","#@ $  $    $  $ #","###### $$ $ #####","     # $    #","     #### ###","        #  #","        #  #","        #  #","        ####"]},{"cells":["              ####","         ######  #","         #       #","         #  #### ###"," ###  ##### ###    #","##@####   $$$ #    #","# $$   $$ $   #....##","#  $$$#    $  #.....#","# $   # $$ $$ #.....#","###   #  $    #.....#","  #   # $ $ $ #.....#","  # ####### ###.....#","  #   #  $ $  #.....#","  ### # $$ $ $#######","    # #  $      #","    # # $$$ $$$ #","    # #       # #","    # ######### #","    #           #","    #############"]},{"cells":["          ####","     #### #  #","   ###  ###$ #","  ##   @  $  #"," ##  $ $$## ##"," #  #$##     #"," # # $ $$ # ###"," #   $ #  # $ #####","####    #  $$ #   #","#### ## $         #","#.    ###  ########","#.. ..# ####","#...#.#","#.....#","#######"]},{"cells":["  #########","  #*.*#*.*#","  #.*.*.*.#","  #*.*.*.*#","  #.*.*.*.#","  #*.*.*.*#","  ###   ###","    #   #","###### ######","#           #","# $ $ $ $ $ #","## $ $ $ $ ##"," #$ $ $ $ $#"," #   $@$   #"," #  #####  #"," ####   ####"]},{"cells":["    #########","  ###   ##  #####","###      #  #   ####","#  $$ #$ #  #  ... #","# #  $#@$## # #.#. #","#  ## #$  #    ... #","# $#    $ # # #.#. #","#    ##  ##$ $ ... #","# $ ##   #  #$#.#. #","## $$  $   $  $... #"," #$  ######    ##  #"," #   #    ##########"," #####"]},{"cells":["################","#              #","# # ######     #","# #  $ $ $ $#  #","# #   $@$   ## ##","# # #$ $ $###...#","# #   $ $  ##...#","# ###$$$ $ ##...#","#     # ## ##...#","#####   ## ##...#","    #####     ###","        #     #","        #######"]},{"cells":["       ####","    ####  #","   ##  #  #","   #  $ $ #"," ### #$   ####"," #  $  ##$   #"," #  # @ $ # $#"," #  #      $ ####"," ## ####$##     #"," # $#.....# #   #"," #  $...*. $# ###","##  #.....#   #","#   ### #######","# $$  #  #","#  #     #","######   #","     #####"]},{"cells":["#####","#   ##","#    #  ####","# $  ####  #","#  $$ $   $#","###@ #$    ##"," #  ##  $ $ ##"," # $  ## ## .#"," #  #$##$  #.#"," ###   $..##.#","  #    #.*...#","  # $$ #.....#","  #  #########","  #  #","  ####"]},{"cells":["       #######"," #######     #"," #     # $@$ #"," #$$ #   #########"," # ###......##   #"," #   $......## # #"," # ###......     #","##   #### ### #$##","#  #$   #  $  # #","#  $ $$$  # $## #","#   $ $ ###$$ # #","#####     $   # #","    ### ###   # #","      #     #   #","      ########  #","             ####"]},{"cells":["      ############","      #  .  ##   #","      # #.     @ #"," ###### ##...# ####","##  ##...####     ####","# $ ##...    $ #  $  #","#     .. ## # ## ##  #","####$###$# $  #   # ##"," ###  #    ##$ $$ # #"," #   $$ # # $ # $## #"," #                  #"," #################  #","                 ####"]},{"cells":["        ######","        #   @####","      ##### $   #","      #   ##    ####","      # $##  ##    #","      #   #  ##### #","      # #$$ $    # #","      #  $ $ ### # #","      # #   $  # # #","      # #  #$#   # #","     ## ####   # # #","     #  $  ##### # # ####","    ##    $     $  ###  ####","#####  ### $ $# $ #   .....#","#     ##      #  ##  #.....#","# $$$$    ######$##   #.##.#","##    ##              #....#"," ##  ###############   ....#","  #  #             #####  ##","  ####                 ####"]},{"cells":["       ############","       #..........#","     ###.#.#.#.#..#","     #   .........#","     #@ $ $ $ *.*.#","    ####### #######"," ####   #    ##  #","##    $ #    # $ ##","#  #$# ### ###$   ##","# $  $ $   # $ $ $ #","#  # $ ##       #$ #","#   $####$####$##  #","####  ##   #    #  #","   #$ ##   # # $$  #","   #   # $ #  $    #","   ### # $$ #  $ ###","     # #    # $ ##","     # ######## #","     #          #","     ############"]},{"cells":["   ##########","   #..  #   #","   #..      #","   #..  #  ####","  #######  #  ##","  #            #","  #  #  ##  #  #","#### ##  #### ##","#  $  ##### #  #","# # $  $  # $  #","# @$  $   #   ##","#### ## #######","   #    #","   ######"]},{"cells":["            ####"," ############  #####"," #    #  #  $  #   ##"," # $ $ $  $ # $ $   #"," ##$ $   # @# $   $ #","###   ############ ##","#  $ $#  #......# $#","# #   #  #......## #","#  ## ## # .....#  #","# #      $...... $ #","# # $ ## #......#  #","#  $ $#  #......# $#","# $   #  ##$#####  #","# $ $ #### $ $  $ $#","## #     $ $ $ $   ###"," #  ###### $    $    #"," #         # ####### #"," ####### #$          #","       #   ###########","       #####"]},{"cells":["       #######","       #  #  ####","       # $#$ #  ##","########  #  #   ########","#....  # $#$ #  $#  #   #","#....# #     #$  #      #","#..#.    $#  # $    #$  #","#... @##  #$ #$  #  #   #","#.... ## $#     $########","########  #$$#$  #","       # $#  #  $#","       #  #  #   #","       ####  #####","          ####"]},{"cells":["   ##########","   #........####","   #.#.#....#  #","   #........$$ #","   #     .###  ####"," #########  $ #   #"," #     $   $ $  $ #"," #  #    #  $ $#  #"," ## #####   #  #  #"," # $     #   #### #","##  $#   # ##  #  #","#    ##$###    #  ##","# $    $ #  #  #   #","#####    # ## # ## ##","    #$# #  $  $ $   #","    #@#  $#$$$  #   #","    ###  $      #####","      ##  #  #  #","       ##########"]},{"cells":["               ####","          ######  #####","    #######       #   #","    #      $ $ ## # # #","    #  #### $  #     .#","    #      $ # # ##.#.#","    ##$####$ $ $ ##.#.#","    #     #    ####.###","    # $   ######  #.#.#","######$$$##      @#.#.#","#      #    #$#$###. .#","# #### #$$$$$    # ...#","# #    $     #   # ...#","# #   ## ##     ###...#","# ######$######  ######","#        #    #  #","##########    ####"]},{"cells":["#########","#       #","#       ####","## #### #  #","## #@##    #","# $$$ $  $$#","#  # ## $  #","#  # ##  $ ####","####  $$$ $#  #"," #   ##   ....#"," # #   # #.. .#"," #   # # ##...#"," ##### $  #...#","     ##   #####","      #####"]},{"cells":[" #################"," #...   #    #   ###","##.....  $## # # $ #","#......#  $  #  $  #","#......#  #  # # # ##","######### $  $ # #  ###","  #     #$##$ ## ##   #"," ##   $    # $  $   # #"," #  ## ### #  #####$# #"," # $ $$     $   $     #"," # $    $##$ ######## #"," #######  @ ##      ###","       ######"]},{"cells":["     #######","     #@ #  #","     # $   #","    ### ## #"," #### $  # ##"," #       #  ##"," # $ $#### $ #"," # $$ #  #  $#"," #$  $   #$  #","##  $$#   $$ ##","# $$  #  #  $ #","#     #### $  #","#  #$##..##   #","### .#....#####","  # .......##","  #....   ..#","  ###########"]},{"cells":["                #####","       ###### ###   ####","   #####    ### $ $  $ #","####  ## #$ $    $ #   #","#....   $$ $ $  $   #$##","#.. # ## #   ###$## #  #","#....    # ###    #    #","#....    # ##  $  ###$ #","#..######  $  #  #### ##","####    #   ###    @  #","        ###############"]},{"cells":[" #####"," #   #######"," # $ ###   #"," # $    $$ #"," ## ####   #","### #  # ###","#   #  #@##","# $$    $ #","#   # # $ ####","##### #   #  #"," #   $####   #"," #  $     $  #"," ##   ##### ##"," ##########  #","##....# $  $ #","#.....# $$#  #","#.. ..# $  $ #","#.....$   #  #","##  ##########"," ####"]},{"cells":[" #######"," #  #  #####","##  #  #...###","#  $#  #...  #","# $ #$$ ...  #","#  $#  #... .#","#   # $########","##$       $ $ #","##  #  $$ #   #"," ######  ##$$@#","      #      ##","      ########"]},{"cells":["  ####","  #  #########"," ##  ## @#   #"," #  $# $ $   ####"," #$  $  # $ $#  ##","##  $## #$ $     #","#  #  # #   $$$  #","# $    $  $## ####","# $ $ #$#  #  #","##  ###  ###$ #"," #  #....     #"," ####......####","   #....####","   #...##","   #...#","   #####"]},{"cells":["      ####","  #####  #"," ##     $#","## $  ## ###","#@$ $ # $  #","#### ##   $#"," #....#$ $ #"," #....#   $#"," #....  $$ ##"," #... # $   #"," ######$ $  #","      #   ###","      #$ ###","      #  #","      ####"]},{"cells":["############","##     ##  #","##   $   $ #","#### ## $$ #","#   $ #    #","# $$$ # ####","#   # # $ ##","#  #  #  $ #","# $# $#    #","#   ..# ####","####.. $ #@#","#.....# $# #","##....#  $ #","###..##    #","############"]},{"cells":["############  ######","#   #    #@####....#","#   $$#       .....#","#   # ###   ## ....#","## ## ###  #   ....#"," # $ $     # ## ####"," #  $ $##  #       #","#### #  #### ## ## #","#  # #$   ## ##    #","# $  $  # ## #######","# # $ $    # #","#  $ ## ## # #","# $$     $$  #","## ## ### $  #"," #    # #    #"," ###### ######"]},{"cells":["     ####","   ###  ##","####  $  #","#   $ $  ####","# $   # $   # ####","#  #  #   $ # #..#","##$#$ ####$####..#"," #   ##### ## ...#"," #$# ##@## ##  ..#"," # #    $     ...#"," #   #### ###  ..#"," ### ## #  ## ...#","  ##$ ####$ ###..#","  #   ##    # #..#"," ## $$##  $ # ####"," #     $$$$ #"," # $ ###    #"," #   # ######"," #####"]},{"cells":["###########","#......   #########","#......   #  ##   #","#..### $    $     #","#... $ $ #  ###   #","#...#$#####    #  #","###    #   #$  # $###","  #  $$ $ $  $##  $ #","  #  $   #$#  ##    #","  ### ## #  $ #######","   #  $ $ ## ##","   #    $  $  #","   ##   # #   #","    #####@#####","        ###"]},{"cells":[" #########"," #....   ##"," #.#.#  $ ##","##....# # @##","# ....#  #  ##","#     #$ ##$ #","## ###  $    #"," #$  $ $ $#  #"," # #  $ $ ## #"," #  ###  ##  #"," #    ## ## ##"," #  $ #  $  #"," ###$ $   ###","   #  #####","   ####"]},{"cells":["              ###","             ##.###","             #....#"," #############....#","##   ##     ##....#####","#  $$##  $ @##....    #","#      $$ $#  ....#   #","#  $ ## $$ # #....#  ##","#  $ ## $  # ## ###  #","## ##### ###         #","##   $  $ ##### ###  #","# $###  # ##### # ####","#   $   #       #","#  $ #$ $ $###  #","# $$$# $   # ####","#    #  $$ #","######   ###","     #####"]},{"cells":["      ####","####### @#","#     $  #","#   $## $#","##$#...# #"," # $...  #"," # #. .# ##"," #   # #$ #"," #$  $    #"," #  #######"," ####"]},{"cells":["           #####","          ##   ##","         ##     #","        ##  $$  #","       ## $$  $ #","       # $    $ #","####   #   $$ #####","#  ######## ##    #","#..           $$$@#","#.# ####### ##   ##","#.# #######. #$ $###","#........... #   $ #","##############  $  #","             ##  ###","              ####"]},{"cells":[" ########"," #@##   ####"," # $   $   #"," #  $ $ $$$#"," # $$# #   #","##$    $   #","#  $  $$$$$##","# $#### #   #","#  $....#   #","# ##....#$$ #","# ##....   ##","#   ....#  #","## #....#$$#"," # #....#  #"," #         #"," #### ##$###","    #    #","    ######"]},{"cells":["    ############","    #          ##","    #  # #$$ $  #","    #$ #$#  ## @#","   ## ## # $ # ##","   #   $ #$  # #","   #   # $   # #","   ## $ $   ## #","   #  #  ##  $ #","   #    ## $$# #","######$$   #   #","#....#  ########","#.#... ##","#....   #","#....   #","#########"]},{"cells":["      ######","   #####   #","   #   # # #####","   # $ #  $    ######","  ##$  ### ##       #","###  $$ $ $ #  ##   #####","#       $   ###### ##   #","#  ######## #@   # #  # #","## ###      #### #$# #  #"," # ### #### ##.. #   $ ##"," #  $  $  #$##.. #$##  ##"," #  # # #     ..## ## $ #"," ####   # ## #..#    $  #","    #####    #..# # #  ##","        ######..#   # ##","             #..#####  #","             #..       #","             ##  ###  ##","              #########"]},{"cells":["        #######","    #####  #  ####","    #   #   $    #"," #### #$$ ## ##  #","##      # #  ## ###","#  ### $#$  $  $  #","#...    # ##  #   #","#...#    @ # ### ##","#...#  ###  $  $  #","######## ##   #   #","          #########"]},{"cells":["    #########  ####","    #   ##  ####  #","    #   $   #  $  #","    #  # ## #     ####","    ## $   $ $$# #   #","    ####  #  # $ $   #","#####  ####    ###...#","#   #$ #  # ####.....#","#      #  # # ##.....#","###### #  #$   ###...#","   #   ## # $#   #...#","  ##       $  $# #####"," ## $$$##  # $   #"," #   #  # ###  ###"," #   $  #$ @####"," #####  #   #","     ########"]},{"cells":[" #####"," #   #"," # # ######"," #      $@######"," # $ ##$ ###   #"," # #### $    $ #"," # ##### #  #$ ####","##  #### ##$      #","#  $#  $  # ## ## #","#         # #...# #","######  ###  ...  #","     #### # #...# #","          # ### # #","          #       #","          #########"]},{"cells":["       ####","       #  ##","       #   ##","       # $$ ##","     ###$  $ ##","  ####    $   #","###  # #####  #","#    # #....$ #","# #   $ ....# #","#  $ # #.*..# #","###  #### ### #","  #### @$  ##$##","     ### $     #","       #  ##   #","       #########"]},{"cells":["      ############","     ##..    #   #","    ##..* $    $ #","   ##..*.# # #$ ##","   #..*.# # # $  #","####...#  #    # #","#  ## #          #","# @$ $ ###  # # ##","# $   $   # #   #","###$$   # # # # #","  #   $   # # #####","  # $# #####      #","  #$   #   #   #  #","  #  ###   ##     #","  #  #      #    ##","  ####      ######"]},{"cells":["     #############","     #    ###    #","     #     $ $  ####","   #### #   $ $    #","  ## $  #$#### $ $ #","###   # #   ###  $ #","# $  $  #  $  # ####","# ##$#### #$#  $  ###","# ##  ### # # #  $  #","#    @$   $   # $ # #","#####  #  ##  # $#  #","  #... #####$  #  # #","  #.......# $$ #$ # #","  #.......#         #","  #.......#######  ##","  #########     ####"]},{"cells":["##### ####","#...# #  ####","#...###  $  #","#....## $  $###","##....##   $  #","###... ## $ $ #","# ##    #  $  #","#  ## # ### ####","# $ # #$  $    #","#  $ @ $    $  #","#   # $ $$ $ ###","#  ######  ###","# ##    ####","###"]},{"cells":[" ####","##  #####","#       # #####","# $###  ###   #","#..#  $# #  # #","#..#      $$# ###","#.*# #  #$ $    #####","#..#  ##     ##$#   #","#.*$  $ # ##  $     #","#..##  $   #   ######","#.*##$##   #####","#..  $ #####","#  # @ #","########"]},{"cells":["   ##########","   #  ###   #","   # $   $  #","   #  ####$##","   ## #  #  #","  ##  #.*   #","  #  ##..#  #","  # @ #.*# ##","  # #$#..#$ #","  # $ #..#  #","  # # #**#  #","  # $ #..#$##","  #    .*#  #"," ###  #  #  #","##    ####  #","#  #######$##","# $      $  #","#  ##   #   #","#############"]},{"cells":[" #####################"," #   ##  #   #   #   #"," # $     $   $   $   ##","##### #  #   ### ##$###","#   # ##$######   #   #","# $   # ......#   # $ #","## #  # ......#####   #","## #########..#   # ###","#          #..# $   #","# ## ### ###..## #  ###","# #   #   ##..## ###  #","#   @      $..#       #","# #   #   ##  #   ##  #","##### ############## ##","#          #   #    $ #","# $  # $ $ $   # #    #","# #$## $#  ## ##    # #","#  $ $$ #### $  $ # # #","#          #   #      #","#######################"]},{"cells":[" #####################","##                   #","#    $ #      ## #   #","#  ###### ###  #$## ##","##$#   ##$#....   # #","#  #    $ #....## # #","# $ # # # #....##   #","# $ #$$   #....##$# #","# # $@$##$#....##   #","#   $$$   #....#    #","#  $#   # ###### $###","##  # ###$$  $   $ #","##     # $  $ ##   #"," #####   #   #######","     #########"]},{"cells":["##########","#        ####","# ###### #  ##","# # $ $ $  $ #","#       #$   #","###$  $$#  ###","  #  ## # $##","  ##$#   $ @#","   #  $ $ ###","   # #   $  #","   # ##   # #","  ##  ##### #","  #         #","  #.......###","  #.......#","  #########"]},{"cells":["         ####"," #########  ##","##  $      $ #####","#   ## ##   ##...#","# #$$ $ $$#$##...#","# #    @  #   ...#","#  $# ###$$   ...#","# $  $$  $ ##....#","###$       #######","  #  #######","  ####"]},{"cells":["              ######","          #####    #","          #  ## #  #####","          #   *.#..#   #"," ##### #### $#.#...    #"," #   ###  ## #*....## ##"," # $      ## #..#..## #","###### #   # #*.##### #","#   # $#$# # #..##### #","# $  $     # #*.    # #","## ##  $ ### #  ##  # #"," #  $  $ ### ##### ## #"," ###$###$###  #### ## #","#### #         ###  # #","#  $ #  $####  ###$$#@#####","#      $ # #  ####  #$#   #","#### #  $# #              #","   #  $  # ##  ##  ########","   ##  ###  ########","    ####"]},{"cells":["         ####","         #  #","         #  ########","   #######  #      #","   #   # # # # #   ##","   # $     $  ##  $ #","  ### $# #  # #     #########","  #  $  #  $# # $$ #   # #  #"," ## #   #     ###    $ # #  #"," #  #$   # ###  #  # $$# #  #"," #    $## $  #   ## $  # # ##","####$ $ #    ##  #   $    ..#","#  #    ### # $ $ ###  ###.*#","#     ##  $$ @  $     ##....#","#  ##  ##   $  #$#  ##....*.#","## #  $  # # $##  ##....*.###","## ##  $  # $ #  #....*.###","#    $ ####   # ....*.###","#   #  #  #  #  ..*.###","########  ###########"]},{"cells":["        #####","        #   ####","        # $    ####  ####","        #   # $#  ####  #","########### #   $   #   #","#..     # $  #### #  #  #","#..$  #   $  #  $ # $ .##","#.*# # $ $ ##  ##    #.#","#..#$ @ #   ##    $$ #.#","#..# $ $  $ $ ##   ## .#","#.*$$ # ##   $ #$# $ #.#","#..#      ##   #     #.#","#..#######  ### ######.##","# $$                  *.##","#  ##################  ..#","####                ######"]}],"max_height":20,"max_width":29,"title":"Spiros 05","total":60}

            let gameTab = $('<table />').css({'border-spacing':'0px','margin':'auto','margin-top':'40px'});

            let player,lastMovement,actualLevel,totalballs,placedballs,balldrops,allowedtoplay;

            let playButton,playerButton;

            let selectedBlock = '#';

            let goal = $('#goal');

            $(monObj.levels).each((index)=>$('<button />').text("Level " + (index+1)).click(()=>{actualLevel = monObj.levels[index];showGameTab(actualLevel.cells);}).appendTo('body'));

            $('<button />').text("Level builder").click(()=>showLevelBuilder()).appendTo('body');

            showGameTab(monObj.levels[0].cells);

            function initCase(acase) {
                switch (acase.html().slice(-1)) {
                    case '@':
                        acase.css('background-color','green');
                        break;
                    case '#':
                        acase.css('background-color','black');
                        break;
                    case '.':
                        acase.css('background-color','blue');
                        break;
                    case '$':
                        acase.css('background-color','red');
                        break;
                    case '*':
                        acase.text('.$');
                        break;
                    case ' ':
                        acase.css('background-color','white');
                        break;
                }
                if(acase.html() === '.$') acase.css('background-color','lightgreen');
            }

            function showLevelBuilder() {
                $('tr').remove();
                $('.levelbuilderbutton').remove();
                for(let i = 0; i < 20; i++) {
                    let tr = $('<tr/>');
                    for(let j = 0; j < 30; j++) {
                        let td = $('<td/>');
                        td.text((i===0 || i===19 || j===0 || j===29)?' ':' ');
                        initCase(td);
                        td.css({'height':'30px','width':'30px','padding':'0','white-space':'pre','color':'rgba(0,0,0,0)','user-select':'none','cursor':'pointer'});
                        td.click(()=>{td.text((td.html() === ' ')?selectedBlock:' ');initCase(td)});
                        tr.append(td);
                    }
                    gameTab.append(tr);
                }
                gameTab.click(()=>checkLevel());
                gameTab.css({'margin-bottom':'20px','background-color':'grey','padding':'2px'}).appendTo('body');
                $('<button />').addClass('levelbuilderbutton').text("Mur").click(()=>selectedBlock = '#').css({'background-color':'black','color':'white'}).appendTo('body');
                $('<button />').addClass('levelbuilderbutton').text("Boule").click(()=>selectedBlock = '$').css({'background-color':'red','color':'white'}).appendTo('body');
                $('<button />').addClass('levelbuilderbutton').text("Place").click(()=>selectedBlock = '.').css({'background-color':'blue','color':'white'}).appendTo('body');
                $('<button />').addClass('levelbuilderbutton').text("Boule placée").click(()=>selectedBlock = '*').css({'background-color':'lightgreen','color':'white'}).appendTo('body');
                playerButton = $('<button />').addClass('levelbuilderbutton').text("Joueur").click(()=>selectedBlock = ' @').css({'background-color':'green','color':'white'}).appendTo('body');
                $('<button />').addClass('levelbuilderbutton').text("Effacer").click(()=>{$('td').text(' ').css('background-color','white').attr('id','');checkLevel()}).appendTo('body');
                allowedtoplay = false;
                goal.text('Boules placées: ' + 0 + '/' + 0);
            }

            function checkLevel(){
                updateVariables();
                if (player.length >= 1) {
                    playerButton.hide();
                    if(selectedBlock === ' @')selectedBlock = '#';
                    if(totalballs === balldrops && totalballs > 0 && balldrops > 0) {
                        if(playButton == null){
                            playButton = $('<button />').addClass('levelbuilderbutton').text("Jouer").click(() => {
                                allowedtoplay = true;
                                playButton.remove();
                                playButton = null;
                            }).appendTo('body');
                        }
                    }
                    else {
                        allowedtoplay = false;
                        playButton.remove();
                        playButton = null;
                    }
                }
                else playerButton.show();
            }

            function showGameTab(cle) {
                $('tr').remove();
                $('.levelbuilderbutton').remove();
                for(let i = 0; i < cle.length; i++) {
                    let tr = $('<tr/>');
                    for(let j = 0; j < cle[i].length; j++) {
                        let td = $('<td/>');
                        td.text(cle[i][j]);
                        if(td.html() === '@')td.text(' ' + td.html());
                        initCase(td);
                        td.css({'height':'30px','width':'30px','padding':'0','white-space':'pre','color':'rgba(0,0,0,0)','user-select':'none'});
                        tr.append(td);
                    }
                    gameTab.append(tr);
                }
                gameTab.css({'margin-bottom':'20px','background-color':'white','padding':'0px'}).appendTo('body');
                goal.text('Boules placées: ' + $("td:contains('.$')").length + '/' + $("td:contains('.')").length);
                allowedtoplay = true;
            }

            function updateVariables(){
                player = $("td:contains('@')");
                balldrops = $("td:contains('.')").length;
                totalballs = $("td:contains('$')").length;
                placedballs = $("td:contains('.$')").length;
                goal.text('Boules placées: ' + placedballs + '/' + balldrops);
            }

            function setPlayer(acase){
                if(acase.html() !== '#'){
                    let allowMove = true;
                    if(acase.html().slice(-1) === '$') {
                        if(getCase(acase).html() === ' '){
                            getCase(acase).text(getCase(acase).html().concat('$'));
                            initCase(getCase(acase));
                            acase.text((acase.html() === '.$')?'.':' ');
                        }
                        else if(getCase(acase).html() === '.'){
                            getCase(acase).text(getCase(acase).html().concat('$'));
                            initCase(getCase(acase));
                            acase.text(acase.html().replace('$',''));
                        }
                        else allowMove = false;
                    }
                    if(allowMove){
                        player.text(player.html().slice(0,1));
                        initCase(player);
                        acase.text(acase.html().concat('@'));
                        initCase(acase);
                    }
                }
            }

            function getCase(acase) {
                switch (lastMovement) {
                    case 'top':
                        return acase.closest("tr").prev().find('td').eq(player.index());
                    case 'right':
                        return acase.closest("td").next();
                    case 'bottom':
                        return acase.closest("tr").next().find('td').eq(player.index());
                    case 'left':
                        return acase.closest("td").prev();
                    default:
                        break;
                }
            }

            $(document).on('keypress',function(e) {
                player = $("td:contains('@')");
                if(allowedtoplay){
                    switch (e.which) {
                        case 122: //Z
                            lastMovement = 'top';
                            break;
                        case 100: //D
                            lastMovement = 'right';
                            break;
                        case 115: //S
                            lastMovement = 'bottom';
                            break;
                        case 113: //Q
                            lastMovement = 'left';
                            break;
                        default:
                            break;
                    }
                    setPlayer(getCase(player));
                    updateVariables();
                    if(placedballs === balldrops)alert('gg');
                }
            });
        });
    </script>
</head>
<body>
<h2>z,q,s,d pour se déplacer</h2>
<h3 id="goal"></h3>
</body>
</html>
